:: ==================================================
::  Malwarebytes-Premium-Reset
:: ==================================================
::  By Matecitos
:: ==================================================


@echo off
title Malwarebytes-Premium-Reset by Matecitos

:: ComprobaciÃ³n de privilegios de administrador
fltmc >nul 2>&1 || (
    echo( && echo   [33m# Se requieren privilegios de administrador. && echo([0m
    PowerShell Start -Verb RunAs '%0' 2> nul || (
        echo   [33m# Haz clic derecho en el script y selecciona "Ejecutar como administrador".[0m
        >nul pause && exit 1
    )
    exit 0
)

echo( && echo   [34mMalwarebytes[0m: Reinicio AutomÃ¡tico de Prueba de 14 DÃ­as
echo( && echo   [[32m+[0m] Comprobando si existe una tarea programada

:: Comprobar si la tarea programada ya existe
schtasks /query /tn "Malwarebytes-Premium-Reset" >nul 2>&1
if not errorlevel 1 (
    echo( && echo   [[32m-[0m] La tarea programada ya existe
) else (
    echo( && echo   [[32m+[0m] Creando tarea programada
    :: Crear tarea programada para ejecutarse cada 14 dÃ­as
    schtasks /create /tn "Malwarebytes-Premium-Reset" /tr "%~dpnx0" /sc weekly /mo 2 /ru SYSTEM /f >nul 2>&1
)

echo( && echo   [[32m+[0m] Falsificando la criptografÃ­a de [33mMachineGuid[0m

:: Generar nuevo GUID y establecerlo como MachineGuid
for /f %%a in ('powershell -c "[guid]::NewGuid().ToString()"') do (
    reg add "HKLM\SOFTWARE\Microsoft\Cryptography" /v "MachineGuid" /t REG_SZ /d "%%a" /f >nul
)

echo( && echo   [[32m+[0m] Listo! && pause >nul && timeout /t 3 >nul
